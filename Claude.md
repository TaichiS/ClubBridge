ClubBridge

《跨校選社系統》全面性開發指引與系統規劃文件
包含：
✅ 專案目標與系統概述
✅ 技術架構
✅ 多租戶結構設計
✅ 使用者與權限
✅ 功能模組詳解
✅ 學校申請/審核流程
✅ 學生與社團資料欄位細節
✅ URL 設計規劃（RESTful API 與前端路由建議）
✅ 部署與維運

---

# 📘 **跨校選社系統** — 完整開發指引（繁體中文）

---

## 📌 一、專案目標

1. 建立**多校共用**的線上選社系統。
2. 不同學校間**資料隔離**（acts\_as\_tenant）。
3. **任意 Google 帳號**可申請創建學校，由超級管理員審核。
4. 社團老師登入後，可自動辨識社團、進行**點名與輸入成績**。
5. 學生以**學號+身分證字號**登入選社，不需要 Google 帳號。
6. 匯入功能支援 Excel，包含詳細欄位規範。

---

## 🧩 二、技術架構

| 層級  | 技術                                  | 功能               |
| --- | ----------------------------------- | ---------------- |
| 前端  | Vite + Vue3 + Tailwind CSS          | SPA              |
| 後端  | Ruby on Rails (API only)            | 商業邏輯、RESTful API |
| 資料庫 | MariaDB                             | 支援多租戶資料          |
| 認證  | Google OAuth2 (教師/老師/管理員)，學生以學號+身分證 |                  |
| 多租戶 | acts\_as\_tenant                    | 依學校隔離資料          |
| 部署  | Docker + VPS / 雲端                   |                  |

---

## 🏫 三、多租戶結構

* 每個學校對應一個 `School` 實體。
* 子網域或 URL 前綴區分：

  * `schoolABC.domain.com` 或 `domain.com/schools/schoolABC`
* 所有學生/社團/報名資料均屬於一個學校（acts\_as\_tenant）。

---

## 🔒 四、使用者與權限

| 身份    | 登入方式          | 權限                                 |
| ----- | ------------- | ---------------------------------- |
| 超級管理員 | Google OAuth2 | 全域審核 / 系統管理                        |
| 學校管理員 | Google OAuth2 | 管理該校社團、學生、選社流程                     |
| 社團老師  | Google OAuth2 | 若信箱與社團老師 email 欄位一致，則管理對應社團（點名/成績） |
| 學生    | 學號+身分證        | 個人報名與查看結果                          |

---

## 🏗 五、功能模組詳解

### 🎓 學校申請與審核

* 任意 Google 帳號登入後可申請創建學校
* 超級管理員於後台查看申請 → 核准/退回
* 核准後產生新 School 實體
* 申請者成為該學校第一位管理員

---

### 🔧 學期初（管理員功能）

| 功能     | 說明                                |
| ------ | --------------------------------- |
| 備份舊資料  | 匯出本校學生、社團、報名紀錄 (Excel / CSV / JSON)       |
| 匯入學生資料 | 上傳 Excel (固定10欄位)                 |
| 匯入社團資料 | 上傳 Excel (固定12欄位，含社團老師 Email 可空白) |
| 設定進站說明 | 公告或系統提示                           |
| 設定活動日期 | 報名起訖、分發日期等                        |
| 學生資料維護 | CRUD                              |
| 社團資料維護 | CRUD                              |
| 初始化狀態  | 重置新學期資料                           |
| 事先指定社團 | 特殊學生強制分派                          |
| 亂數指定社團 | 自動填補未選社學生 （這是測試用功能）                |

---

### 🕒 選社期間（管理員）

| 功能       | 說明         |
| -------- | ---------- |
| 列出未選社名單  |            |
| 查詢/解鎖重選  | 單一學生解鎖重新選社 |
| 即時報名統計   | 顯示各社名額剩餘   |
| 特殊身份學生清單 |            |
| 開始分發     | 啟動自動分派     |
| 衰運學生處理   | 未分配學生處理    |
| 廢除社團處理   | 停用社團重新分派   |

---

### 📊 選社結果（管理員）

| 功能       | 說明      |
| -------- | ------- |
| 查詢學生選社結果 | 單筆/批次   |
| 匯出各社最終人數 | PDF/CSV |
| 查詢實際人數   | 確認名額    |
| 列印各班結果   |         |
| 社團老師點名表  |         |
| 轉社處理     |         |
| 高一分組重編   |         |

---

### 👩‍🏫 社團老師專屬

| 功能                 | 說明       |
| ------------------ | -------- |
| Google 登入 → 自動匹配信箱 |          |
| 查看自己管理社團的學生名單      |          |
| 點名                 | 記錄每堂課出缺席 |
| 輸入期末成績             |          |

---

### 🧑‍🎓 學生專屬

| 功能     | 說明      |
| ------ | ------- |
| 登入     | 學號+身分證號 |
| 選社     | 填寫志願    |
| 查看最終結果 | 公布後     |

---

## 🗂 六、資料欄位規格（詳細）

### 📄 學生資料欄位（10欄）

| #  | 名稱     | 格式/說明            | 必填 |
| -- | ------ | ---------------- | -- |
| 1  | 年級     | 半形數字：國一=1，高一=4   | ✔  |
| 2  | 班級（數字） | 半形數字，忠=1         | ✔  |
| 3  | 班級（中文） | 忠/孝/仁…           | ✔  |
| 4  | 座號     | 半形數字             | ✔  |
| 5  | 學號     | 唯一               | ✔  |
| 6  | 姓名     | 中文               | ✔  |
| 7  | 身分證字號  | 作為密碼             | ✔  |
| 8  | 條件一    | 性別（男=1，女=2）或空白/0 | ✘  |
| 9  | 條件二    | 高中=1，國中=2 或空白/0  | ✘  |
| 10 | 條件三    | 客製               | ✘  |

---

### 📄 社團資料欄位（12欄）

| #  | 名稱         | 說明              | 必填 |
| -- | ---------- | --------------- | -- |
| 1  | 類別         | 體育/藝文等          | ✔  |
| 2  | 編號         | 半形數字唯一          | ✔  |
| 3  | 社團名稱       | 中文              | ✔  |
| 4  | 指導老師       | 中文姓名           | ✔  |
| 5  | 簡介         | 最多500字          | ✔  |
| 6  | 最大人數       | 半形數字            | ✔  |
| 7  | 上課地點       |                 | ✔  |
| 8  | 雨天地點       |                 | ✘  |
| 9  | 備註         |                 | ✘  |
| 10 | 條件一        | 限制男生=1、女生=2，否則0 | ✘  |
| 11 | 條件二        | 高中=1，國中=2，否則0   | ✘  |
| 12 | 條件三        | 客製              | ✘  |
| 13 | 社團老師 Email | 老師登入識別用，可空白     | ✘  |

---

## 🌐 七、網址與路由設計（建議）

### 前端路由

| 路徑                | 功能     |
| ----------------- | ------ |
| `/`               | 公開首頁   |
| `/apply`          | 申請新學校  |
| `/admin`          | 管理員後台  |
| `/teacher`        | 社團老師專區 |
| `/student`        | 學生登入頁  |
| `/student/choose` | 選社     |
| `/student/result` | 查看結果   |

---

### API （RESTful 建議）

| Method | URL                                                 | 功能      |
| ------ | --------------------------------------------------- | ------- |
| POST   | `/api/schools/apply`                                | 申請新學校   |
| GET    | `/api/admin/schools/pending`                        | 查看待審核學校 |
| POST   | `/api/admin/schools/:id/approve`                    | 核准學校    |
| POST   | `/api/schools/:school_id/students/import`           | 匯入學生    |
| POST   | `/api/schools/:school_id/clubs/import`              | 匯入社團    |
| GET    | `/api/schools/:school_id/clubs/realtime`            | 即時統計    |
| POST   | `/api/schools/:school_id/clubs/:club_id/attendance` | 老師點名    |
| POST   | `/api/schools/:school_id/clubs/:club_id/score`      | 老師輸入成績  |
| POST   | `/api/schools/:school_id/assign`                    | 啟動分發    |

（以上僅示例，可用 Swagger 完整定義）

---

## 🚀 八、部署與維運

* MariaDB 每日備份
* Docker 容器化部署
* Google OAuth 憑證定期檢查
* 操作日誌 & 審核日誌
* 定期更新依賴套件
* SSL 憑證自動更新

---

## ✅ 九、預期交付

* Rails API 專案
* Vue3 前端專案
* Swagger API 文件
* ERD
* Excel 匯入樣板
* Docker 部署腳本
* 管理手冊與文件


## 十、後續優化 （選用）

這份系統規劃文件已經相當完整，不過我發現幾個可以優化和補充的地方：

## 🔐 **安全性強化**

**學生登入安全**
- 建議加入帳號鎖定機制（連續登入失敗後暫時鎖定）
- 身分證字號應加密儲存，不建議明文存放
- 考慮加入簡單的圖形驗證碼防止暴力破解

**資料保護**
- 個資處理需符合相關法規
- 建議加入資料保存期限設定（如畢業後資料清理）
- API 需要 rate limiting 防止濫用

## 📱 **使用者體驗優化**

**學生端功能**
- 志願序拖拉排序介面
- 社團收藏/關注功能
- 選社期間剩餘時間倒數提醒
- 手機版響應式設計優化

**通知系統**
- Email/SMS 通知選社結果
- 重要時程提醒（選社開始/結束）
- 社團老師課程提醒

## 🔄 **業務流程補強**

**選社規則引擎**
- 支援更複雜的分發演算法（如志願優先 vs 隨機公平）
- 社團優先序設定（熱門社團的處理策略）
- 轉社申請與審核流程
- 退社機制

**報表與統計**
- 歷年選社趨勢分析
- 社團滿意度調查
- 出缺席統計報表
- 成績分布統計

## 🎯 **功能增強建議**

**社團管理**
- 社團活動記錄（照片、心得）
- 社團成果展示頁面
- 社團評鑑功能
- 跨校社團交流平台

**系統管理**
- 操作日誌追蹤（誰在何時做了什麼）
- 系統健康監控
- 自動化測試環境
- 版本控制與回滾機制

## 🗄️ **資料庫設計補充**

**建議新增資料表**
```
- audit_logs（操作日誌）
- notifications（通知記錄）
- system_settings（系統設定）
- club_activities（社團活動記錄）
- student_feedback（學生反饋）
```

## 🌍 **擴展性考量**

**國際化準備**
- 多語言支援架構
- 時區處理
- 不同學制適配

**API 版本管理**
- API versioning 策略
- 向下相容性維護
- 第三方整合接口預留

## 📋 **缺失的重要流程**

1. **災難復原計畫** - 資料庫損壞時的恢復流程
2. **學期交接** - 舊學期資料封存與新學期初始化
3. **大量並發處理** - 選社開放瞬間的流量處理
4. **資料同步** - 學生異動時的即時更新機制

## 🔧 **技術架構建議**

**快取策略**
- Redis 快取熱門查詢
- CDN 靜態資源加速

**監控告警**
- 應用程式效能監控（APM）
- 資料庫效能監控
- 伺服器資源監控
